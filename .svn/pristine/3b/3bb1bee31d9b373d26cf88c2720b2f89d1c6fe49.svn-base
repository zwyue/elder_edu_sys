<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>老年大学系统——学委会管理</title>
    <link rel="stylesheet" href="plugins/layui-v2.4.3/layui/css/layui.css"/>
    <link rel="stylesheet" href="css/common_style.css" />
    <link rel="stylesheet" href="css/xwhgl.css" />

</head>
<body>
   <!--学委会管理内容-->
   <div class="layui-body yhglContent">
			<span class="layui-breadcrumb yhgl_nav">
			  <a href="javascript:;"><cite>学委会管理</cite></a><span lay-separator="">＞</span>
			  <a href="javascript:;">学委会管理</a>
			</span>
    <!--查询-->
    <div class="layui-form chaXun">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">姓名：</label>
                <div class="layui-input-inline">
                    <input type="text" class="layui-input" id="name">
                </div>
            </div>
            <!--<div class="layui-inline">-->
                <!--<label class="layui-form-label">身份证：</label>-->
                <!--<div class="layui-input-inline">-->
                    <!--<input type="text" class="layui-input" id="idCard">-->
                <!--</div>-->
            <!--</div>-->
            <a href="javascript:;" class="btn_chaXun fr" id="chaXun" onclick="chaxun()">查询</a>
        </div>
    </div>
    <!--查询 end-->

    <!--表格-->
    <div class="biaoGe">
        <section >
            <span class="xslb_bt fl">学委会列表</span>
            <a href="xwhgl_xz.html" class="xzxs fr" id="xzxs" >
                <i class="layui-icon layui-icon-add-1"></i>新增学生
            </a>
        </section>
        <!---数据表格-->
        <table class="layui-table" lay-skin="line" id="tb">
            <thead>
            <tr>
                <th>序号</th>
                <th>姓名</th>
                <th>班级</th>
                <th>联系方式</th>
                <th>家属联系方式</th>
                <th>加入时间</th>
                <th>职务</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody id="list"></tbody>
        </table>
        <!--<p class="showPage">每页显示-->
            <!--<select>-->
                <!--<option value ="volvo">7</option>-->
                <!--<option value ="saab">14</option>-->
                <!--<option value="opel">21</option>-->
            <!--</select>-->
            <!--列</p>-->
        <!--数据表格 end-->

        <!--分页-->
        <div class="page">
            <!--<p>共50页</p>-->
            <div id="demo5"></div>
        </div>
        <!--分页 end-->
    </div>
    <!--表格end-->
</div>
<!--学委会管理内容 end-->

   <!--添加职务弹窗-->
   <div id="addjob" style="display:none;">
       <div style="width: 80%; text-align:center;  margin:0 auto; padding-top:5%;">
           <form class="" action="">
               <div class="layui-form-item">
                   <label class="layui-form-label">职务：</label>
                   <div class="layui-input-inline">
                       <input type="text" id="business" name="business" class="layui-input">
                       <input type="hidden" id="hide">
                   </div>
               </div>
               <div class="layui-form-item">
                   <div class="btn-hmc">
                       <a onclick="add()" class="layui-btn layui-btn-normal qd" lay-filter="formDemo">确定</a>
                   </div>
               </div>
           </form>
       </div>
   </div>

   <script src="plugins/jQuery/jquery-3.3.1.js"></script>
   <script src="plugins/layui-v2.4.3/layui/layui.js"></script>
   <!--<script src="js/xwhgl.js"></script>-->
   <script>
       $(function () {
           DatatoLoad();
       });
       function DatatoLoad() {
           //分页
           var pageNum = 0;    //初始化页数为第一页
           var pageSize = 7;   //列表数量为7条
           layui.use('laypage', function () {
               var laypage = layui.laypage;
               var totalSize = 0; //初始化数据总数
               getDatasSize();

               function getDatasSize() {
                   $.ajax({
                       type: 'get',
                       async: false,
                       url: "http://192.168.0.166:8080/studymeet/list",
                       data: {
                           page: pageNum,
                           size: pageSize
                       },
                       dataType: "json",
                       xhrFields: {withCredentials: true},
                       success: function (data) {
                           totalSize = data.data.total; //获得数据总条数
                           var html = '';
                           var len = data.data.list.length;
                           for (var i = 1; i < len + 1; i++) {
                               $('table tr:eq(' + i + ')td:first').text(i);
                           }
                           $.each(data.data.list, function (i, result) {
                               html += "<tr id=add"+ result.id +">";
                               html += "<td>" + (i + 1) + "</td>" + "<td>" + result.sname + "</td>"+ "<td>" + result.classname + "</td>" +
                                   "<td>" + result.phone + "</td>" + "<td>" + result.emergency + "</td>" +"<td>" + result.crttime + "</td>"+
                                   "<td>" + result.business + "</td>" +
                                   "<td>" +
                                       "<a href='JavaScript:;' onclick='addBusiness(" + result.id + ")'  class='bg bgActive Add'>添加职务</a>" +
                                       "<a href='JavaScript:;' onclick='delect(" + result.id + ")' class='bg bgActive del'>删除</a>" +
                                   "</td>"
                               html += "</tr>";
                           })
                           $("#list").html(html);
                       },
                       error: function () {
                           console.log("error");
                       },
                   })
               }

               //执行一个laypage
               laypage.render({
                   elem: 'demo5',    //分页容器，此处是id
                   count: totalSize, //数据总数，从服务端得到
                   curr: pageNum,
                   limit: pageSize,
                   jump: function (obj, first) {
                       pageNum = obj.curr;     //得到当前页，以便向服务端请求对应页的数据。
                       pageSize = obj.limit;   //得到每页显示的条数

                       //首次不执行
                       if (!first) {
                           $("#list").empty();
                           getDatasSize();
                       }
                   }
               })
           })
       }
       //添加职务
       function addBusiness(id) {
           $("#hide").val(id);
           layui.use('layer', function(){
               var layer = layui.layer;
               layer.open({
                   //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                   type: 1,
                   skin: '',
                   title: "新增职务",
                   area: ['40%', '40%'],
                   content: $("#addjob")
               })
               // var tdjob = $('#add'+id+'');
               // var tdjob = $('#add'+id+'').children("td").eq(6).val;
               //var tdjob=$('#add'+id+'').children("td").eq(6).text();
           })
       }
       function add(){
           var business=$("#business").val();
           console.log(business);
           var id=$("#hide").val();
           // alert(business);
           $.ajax({
               type: 'POST',
               url: "http://192.168.0.166:8080/studymeet/addduties",
               async: false,
               data: {
                   id: id,
                   business:business,
               },
               dataType: "json",
               xhrFields: {withCredentials: true},
               success: function (data) {
                   window.location.href="xwhgl.html";
               },
               error: function () {
                   layui.use('layer', function () {
                       var layer = layui.layer;
                       layer.msg('添加职务失败！');
                   });
               }
           })
       }

       //删除
       function delect(id) {
           $.ajax({
               type: 'get',
               url: "http://192.168.0.166:8080/studymeet/delete",
               async: false,
               data: {
                   id: id
               },
               dataType: "json",
               xhrFields: {withCredentials: true},
               success: function (data) {
                   if (data.code == 1) {
                       layui.use('layer', function(){
                           layer.confirm('确认要删除吗？', function(index){
                               //发异步删除数据
                               layer.msg('已删除!', {
                                   icon: 1,
                                   time: 1000
                               });
                               DatatoLoad();
                           });
                       });
                   } else {
                       layui.use('layer', function () {
                           var layer = layui.layer;
                           layer.msg('删除失败！');
                       });
                   }
               },
               error: function () {
                   layui.use('layer', function () {
                       var layer = layui.layer;
                       layer.msg('删除失败！');
                   });
               }
           })
       }

       //查询
       function chaxun() {
           //验证真实姓名
           var name = $('#name').val();
           if (name == '') {
               layui.use('layer', function () {
                   var layer = layui.layer;
                   layer.alert('请输入姓名', {area: ['200px']});
               });
               return false;
           }
           else {
               //分页
               var pageNum = 0;    //初始化页数为第一页
               var pageSize = 7;   //列表数量为7条
               layui.use('laypage', function () {
                   var laypage = layui.laypage;
                   var totalSize = 0; //初始化数据总数
                   getQuery();

                   function getQuery() {
                       $.ajax({
                           type: 'GET',
                           url: "http://192.168.0.166:8080/studymeet/query",
                           async: false,
                           data: {
                               sname: name,
                               page: pageNum,
                               size: pageSize
                           },
                           dataType: "json",
                           xhrFields: {withCredentials: true},
                           success: function (data) {
                               if (data.data.list.length == 0) {
                                   layui.use('layer', function () {
                                       var layer = layui.layer;
                                       layer.alert('该学生未查到相关信息', {area: ['200px']});
                                   });
                                   $("#list").html('');
                                   return false;
                               }
                               else {
                                   totalSize = data.data.total;
                                   var chaXun;
                                   var len = data.data.list.length;
                                   for (var i = 1; i < len + 1; i++) {
                                       $('table tr:eq(' + i + ')td:first').text(i);
                                   }
                                   $.each(data.data.list, function (i, result) {
                                       chaXun += "<tr>";
                                       chaXun += "<td>" + (i + 1) + "</td>" + "<td>" + result.sname + "</td>" + "<td>" + result.classname + "</td>" +
                                           "<td>" + result.phone + "</td>" + "<td>" + result.emergency + "</td>" + "<td>" + result.crttime + "</td>" +
                                           "<td>" + result.business + "</td>" +
                                           "<td>" +
                                           "<a href='JavaScript:;' onclick='addBusiness(" + result.id + ")' class='bg bgActive Add'>添加职务</a>" +
                                           "<a href='JavaScript:;' onclick='delect(" + result.id + ")' class='bg bgActive del'>删除</a>" +
                                           "</td>"
                                       chaXun += "</tr>";
                                   })
                                   $("#list").html(chaXun);
                               }
                           },
                           error: function () {
                               layui.use('layer', function () {
                                   var layer = layui.layer;
                                   layer.msg('查询失败！');
                               });
                           }
                       })
                   }

                   //执行一个laypage
                   laypage.render({
                       elem: 'demo5',    //分页容器，此处是id
                       count: totalSize, //数据总数，从服务端得到
                       curr: pageNum,
                       limit: pageSize,
                       jump: function (obj, first) {
                           pageNum = obj.curr;     //得到当前页，以便向服务端请求对应页的数据。
                           pageSize = obj.limit;   //得到每页显示的条数

                           //首次不执行
                           if (!first) {
                               $("#list").empty();
                               getQuery();
                           }
                       }
                   })
               })
           }
       }
   </script>
</body>
</html>
