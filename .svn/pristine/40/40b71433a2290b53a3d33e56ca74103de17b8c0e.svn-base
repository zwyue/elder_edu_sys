<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>老年大学系统—报名管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="plugins/layui-v2.4.3/layui/css/layui.css" />
    <link rel="stylesheet" href="css/common_style.css" />
    <link rel="stylesheet" href="css/bmgl_xzbj_xsxx.css" />
    <style>
        /*弹窗样式*/
        body .layui-layer-title{
            background-color: #3d9def;
            border-radius: 0.3rem;
            color: #FFFFFF;
            font-size: 18px;
        }
        body .layui-layer{
            border-radius: 0.5rem;
        }
        body .tc_btn button{
            border-radius: 0.3rem;
        }
        .layui-table th{
            text-align: center;
        }
        .layui-layer-close{
            position: unset!important;
        }
    </style>
</head>
<body>
    <!--下拉选择框 内容主体区域 -->
    <div class="layui-body body_contain" id="bmbjContent">
       <blockquote class="body_header">
          <span class="">
            <a href="javascript:;" class="txt_xsl2">报名管理</a>&nbsp;<span lay-separator="">></span>
            <a href="javascript:;" class="txt_xsl3">选择班级</a>
          </span>
       </blockquote>
       <section class="contain-bg">
           <div class="contain_text">
               <div class="contain-left">
                  <span class="bmbj_bj">报名班级</span>
               </div>
           </div>
           <div class="bj_classify">
            <!--三级菜单联动-->			
			<form  lay-filter="test">
				<div class="layui-form-item layui-form"  lay-filter="classCategory">
		          <label class="layui-form-label">班级类别：</label>
		          <div class="layui-input-block">
		            <select name="classCategory" lay-verify="required"  id="classCategory" >
		            	<option value="">请选择</option>
		            </select>

		          </div>
		        </div>
				<div class="layui-form-item layui-form" lay-filter="classMajor">
		          <label class="layui-form-label">班级专业：</label>
		          <div class="layui-input-block">
		            <select name="classMajor" lay-verify="required" id="classMajor">
		              <option value="">请选择</option>
		            </select>			          
		          </div>
		        </div>
				<div class="layui-form-item layui-form" lay-filter="classes">
		          <label class="layui-form-label">具体班级：</label>
		          <div class="layui-input-block">
		            <select name="classes" lay-verify="required" id="classes">
		              <option value="">请选择</option>
		            </select>
		          </div>
		       </div>				
			</form>				
			<!--三级菜单联动end-->
			</div>
       </section>
        <div class="btn">
            <input type="button" value="下一步" id="xyb_btn">
        </div>
    </div>
    <!--下拉选择框 内容主体区域end -->

	<!--学生报名 内容主体区域 -->
    <div class="layui-body body_contain" id="xsbmContent" style="display: none;">
        <blockquote class="body_header">
              <span class="">
                <a href="javascript:;" class="txt_xsl2">报名管理</a>&nbsp;<span lay-separator="">></span>
                <a href="javascript:;" class="txt_xsl3">学生信息</a>
              </span>
              <span class="fanHui">
				<a href="javascript:;">返回</a>
			  </span>
        </blockquote>
        <section class="contain-bg">
            <div class="contain_text">
                <div class="contain-left">
                    <span class="bmbj_bj">学生报名</span>
                </div>
                <div class="contain-right">
                    <button type="button" id="btn" class="ydbtn" onclick="ydbutton()" name="btn"><i class="iconfont icon-daochu"></i>异动档案</button>
                </div>
            </div>
            <section class="getInfo">											
				<span class="getInfoBtn" onclick="new Device().startFun()">读取身份证信息</span>						
			</section>
            <div class="xsxx_classify">
                <form class="layui-form z-from" action="">
                   <div class="xsxx_left">
                       <div class="layui-form-item">
                          <label class="layui-form-label">学生姓名：</label>
                          <div class="layui-input-block">
                             <input type="text" name="title" required  lay-verify="required" placeholder="识别身份证获取"  autocomplete="off" class="layui-input" id="personName">
                          </div>
                       </div>
                       <div class="layui-form-item">
                          <label class="layui-form-label">身份证号：</label>
                          <div class="layui-input-block">
                              <input type="text" name="identity" lay-verify="required|identity"placeholder="识别身份证获取" autocomplete="off" class="layui-input" id="certNumber">
                          </div>
                       </div>
                       <div class="layui-form-item">
                           <label class="layui-form-label">联系方式：</label>
                           <div class="layui-input-block">
                               <input type="text" name="phone" required  lay-verify="required|phone" autocomplete="off" class="layui-input" id="phone">
                           </div>
                       </div>
                       <div class="layui-form-item">
                           <label class="layui-form-label">现地址：</label>
                           <div class="layui-input-block">
                               <input type="text" required  lay-verify="required"  autocomplete="off" class="layui-input" id="currentAddress">
                           </div>
                       </div>
                       <div class="layui-form-item layui-form" lay-filter="studentCard">
				          <label class="layui-form-label">学生证：</label>
				          <div class="layui-input-block">
				            <select name="classes" lay-verify="required" id="studentCard">
				              <option value="">请选择</option>
				              <option value="0">是</option>
				              <option value="1">否</option>
				            </select>
				          </div>
				       </div>	
				       <div class="layui-form-item">
                           <label class="layui-form-label">入学时间:</label>
                            <div class="layui-input-block">
					    	    <input type="text" class="layui-input" id="entertime" placeholder="请选择入学时间">
						    </div>
                       </div> 
                       <!--<div class="layui-form-item">
	                      <label class="layui-form-label">入学时间：</label>
	                      <div class="layui-input-block">
	                          <select class="endtime" id="year1" name="year1"></select>
	                          <select class="endtime" id="month1" name="month1"></select>
	                          <select class="endtime" id="day1"  name="day1"></select>
	                      </div>
	                  </div>-->
                   </div>
                   <div class="xsxx_right">
                       <div class="layui-form-item">
                           <label class="layui-form-label">性别:</label>
                           <div class="layui-input-block">
                               <input type="text" required  lay-verify="required" placeholder="识别身份证获取" autocomplete="off" class="layui-input" id="gender">
                           </div>
                       </div>
                       <div class="layui-form-item">
                           <label class="layui-form-label">民族:</label>
                           <div class="layui-input-block">
                               <input type="text" required  lay-verify="required" placeholder="识别身份证获取" autocomplete="off" class="layui-input" id="nation">
                           </div>
                       </div>
                       <div class="layui-form-item">
                           <label class="layui-form-label">家庭联系:</label>
                           <div class="layui-input-block">
                               <input type="text" name="phone" required  lay-verify="required|phone" autocomplete="off" class="layui-input" id="emergency">
                           </div>
                       </div>
                       <div class="layui-form-item">
                           <label class="layui-form-label">报名费用:</label>
                           <div class="layui-input-block">
                               <input type="text" name="title" required  lay-verify="required"  autocomplete="off" class="layui-input" id="fee">
                           </div>
                       </div>
                       <div class="layui-form-item">
                           <label class="layui-form-label">汽车牌号:</label>
                           <div class="layui-input-block">
                               <input type="text" name="title" required  lay-verify="required" autocomplete="off" class="layui-input" id="carNumber">
                           </div>
                       </div>
                       <div class="layui-form-item">
                           <label class="layui-form-label">毕业时间:</label>
                            <div class="layui-input-block">
					    	    <input type="text" class="layui-input" id="graduatetime" placeholder="毕业时间大于开学时间">
						    </div>
                       </div> 
                       <!--<div class="layui-form-item">
	                      <label class="layui-form-label">毕业时间：</label>
	                      <div class="layui-input-block">
	                          <select class="endtime" id="year2" name="year2"></select>
	                          <select class="endtime" id="month2" name="month2"></select>
	                          <select class="endtime" id="day2" name="day2"></select>
	                      </div>
	                  </div>-->
                   </div>
                </form>
            </div>
        </section>
        <div class="btn">
            <input type="button" value="报名" id="enroll">
        </div>
        <!--<div class="layui-form-item">
		    <div class="layui-input-block">
		      <button class="layui-btn" lay-submit="" lay-filter="demo1">提交</button>
		    </div>
		</div>-->
    </div>
    <!--学生报名 内容主体区域end -->
    <!--弹出层内容-->
    <div id="popSearchRoleTest" style="display:none;">
        <div style="width: 80%; text-align:center;  margin:0 auto; padding-top:5%;">
            <form class="layui-form">
                <div class="table_style">
                    <table class="layui-table">
                        <colgroup>
                            <!--<col width="150">-->
                            <!--<col width="200">-->
                            <!--<col >-->
                        </colgroup>
                        <thead>
                        <tr>
                            <th>序号</th>
                            <th>异动类型</th>
                            <th>异动时间</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>1</td>
                            <td>退学</td>
                            <td>2018-11-11</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>退学</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>休学</td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="layui-form-item">
                    <div class="tc_btn">
                        <button type="button" class="layui-layer-close layui-btn layui-btn-normal">关闭</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!--弹出层内容end-->
	
    <script src="./plugins/jQuery/jquery-3.3.1.min.js"></script>
    <script src="./plugins/layui-v2.4.3/layui/layui.js"></script>
    <script src="js/common.js"></script>
    <script src="js/yhgl_lsgl_select.js"></script>
    <!--身份证读取-->
	<script type="text/javascript" src="js/baseISSObject.js"></script>
	<script type="text/javascript" src="js/baseISSOnline.js"></script>
	<script type="text/javascript" src="js/commonId.js"></script>		
	<!--身份证读取end-->
   <script src="./js/bmgl_tc.js"></script>
   <script>
//		$('#xyb_btn').click(function(){
//			window.location="bmgl_xsxx.html";
//		})
		//点击下一步
		$('#xyb_btn').click(function(){
			$('#bmbjContent').hide();
			$('#xsbmContent').show();
		})
		$('.fanHui').click(function(){
			$('#bmbjContent').show();
			$('#xsbmContent').hide();
		})
	</script>
	   <!--<script>
        //时间联动
        new YMDselect('year1','month1','day1');
        new YMDselect('year2','month2','day2');

        //获取浏览地址id
        (function ($) {
            $.getUrlParam = function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]); return null;
            }
        })(jQuery);
        var lastdate=$.getUrlParam('lastdate');
        //新增
        function btnXz(){
            var Title = document.getElementById("title").value;
            var CreateTimeYear=$("#year1 option:selected").val();
            var CreateTimeMonth=$("#month1 option:selected").val();
            var CreateTimeDay=$("#day1 option:selected").val();
            var EndTimeYear=$("#year2 option:selected").val();
            var EndTimeMonth=$("#month2 option:selected").val();
            var EndTimeDay=$("#day2 option:selected").val();
            if(CreateTimeMonth<10){
                CreateTimeMonth='0'+CreateTimeMonth;
            }
            if(CreateTimeDay<10){
                CreateTimeDay='0'+CreateTimeDay;
            }

            var CreateData=CreateTimeYear + "-" + CreateTimeMonth + "-" + CreateTimeDay;
            if(EndTimeMonth<10){
                EndTimeMonth='0'+EndTimeMonth;
            }
            if(EndTimeDay<10){
                EndTimeDay='0'+EndTimeDay;
            }
            var EndData=EndTimeYear + "-" + EndTimeMonth + "-" + EndTimeDay;

            if(CreateData>lastdate && CreateData<EndData ){
                $.ajax({
                    type: 'post',
                    url: "http://192.168.0.146:8088/term/newterm",
                    async: false,
                    data: {
                        term: Title,
                        starttime: CreateData,
                        endtime: EndData
                    },
                    dataType: 'json',
                    xhrFields: {withCredentials: true},
                    success: function (data) {
                        window.location.href = "xqgl.html";
                    },
                    error: function () {
                        layui.use('layer', function () {
                            var layer = layui.layer;
                            layer.msg('新增失败！');
                        });
                    }
                });
            }
            else {
                layui.use('layer', function (){
                    var layer = layui.layer;
                    layer.msg('开始时间应小于结束时间且<br>开始时间应大于上次的结束时间!');
                });
            }
        }
    </script>-->
	<script>
		//时间验证
		function checkEndTime(){
			var startTime=$("#entertime").val();
			var start=new Date(startTime.replace("-", "/").replace("-", "/"));
			var endTime=$("#graduatetime").val();
			var end=new Date(endTime.replace("-", "/").replace("-", "/"));
			if(end<start){
				layui.use('layer', function(){ 
						var layer = layui.layer;
						layer.msg('毕业时间要大于入学时间');
						});
			 	return false;
			}
			return true;
		};
		
		layui.use(['layer', 'form','laydate'], function(){
            var form = layui.form;  
            var laydate = layui.laydate; 
			          
		  //入学时间
		  laydate.render({
		    elem: '#entertime'
		  });
		  //毕业时间
		  laydate.render({
		    elem: '#graduatetime'
		  });
		//报名方法
		$('#enroll').click(function(){ 
			var stuname       = $('#personName').val();         //学生姓名
			var sex           = $('#gender').val();             //性别
			var sfzh          = $('#certNumber').val();         //身份证号
			var nation        = $('#nation').val();             //民族
			var address       = $('#currentAddress').val();     //现住址
			var phone         = $('#phone').val();              //联系方式
			var carnumber     = $('#carNumber').val();          //汽车车牌号
			var emergency     = $('#emergency').val();	        //家庭联系方式
			var fee           = $('#fee').val();                //学费
			var entertime     = $('#entertime').val();          //入学时间
			var graduatetime  = $('#graduatetime').val();       //毕业时间
			var studentCard=$('#studentCard option:selected').val();           //学生证val
//			var studentCard= $('#studentCard option:selected').text();         //学生证
			var classCategoryId =  $('#classCategory option:selected').val();  //班级类别ID
			var classCategory =  $('#classCategory option:selected').text();   //班级类别名称
			var classMajorId = $('#classMajor option:selected').val();         //班级专业ID
			var classMajor = $('#classMajor option:selected').text();          //班级专业名称
			var classesId    = $('#classes option:selected').val();            //具体班级ID
			var classes    = $('#classes option:selected').text();             //具体班级名称
			$.ajax({
				type: "post",
				async: false,
				url: server+"/student/enter",
				xhrFields: {withCredentials: true}, 
				data:{
		        	stuname:stuname, 
		        	sex:sex,
		        	sfzh:sfzh,
		        	nation:nation,
	        		sfzaddress:address,
		        	phone:phone,
		        	carnumber:carnumber,
		        	emergency:emergency,
		        	iscard:studentCard,  //0是需要学生证，1是不需要学生证
		        	fee:fee,
		        	entertime:entertime,
		        	graduatetime:graduatetime,
		        	//专业分类ID
		        	cateid:classCategoryId,
		        	//专业分类名称
		        	catename:classCategory,
		        	//专业ID
		        	majorid:classMajorId,
		        	//专业名称
		        	majorname:classMajor,
		        	//班级ID
		        	classid:classesId,
		        	//班级名称
		        	classname:classes,
		        },
//		        success:function(data){
//		        	layui.use('layer', function(){
//						var layer = layui.layer;
//						layer.msg('新增成功');
//						});
////						setTimeout(function(){
////							window.location="bmgl_xzbj.html";
////						},800)	
//		        },
				success: function(data){			
					if(data.code==1){
						layui.use('layer', function(){
						var layer = layui.layer;
						layer.msg('报名成功');
						});
						setTimeout(function(){
							window.location="bmgl_xzbj.html";
						},800)	
					}else{
						layui.use('layer', function(){ 
						var layer = layui.layer;
						layer.msg('报名失败：'+data.msg);
						});
					}										
				},
				error: function(){
					layui.use('layer', function(){
						var layer = layui.layer;
						layer.msg('请求失败');
					});
				}
			});
		});
	}); 
		
	</script>

</body>
</html>