	$(function() {
		ajaxPLists();
	});

	function ajaxPLists() {
		//分页
		layui.use('laypage', function() {
			var laypage = layui.laypage;
			var totalRecord = 0; //初始化总记录数             
			var pageNum = 1,
				pageSize = 10; //初始化页数为第一页
			//每页显示条数
			getNewsData();

			function getNewsData() {
				$.ajax({
					type: "get",
					async: false,
					url: "api/classes/class-list",
					data: {
						page: pageNum,
						size: pageSize
					},
					success: function(data){
						totalRecord = data.data.total; //数据总条数
						var html = "";
						$.each(data.data.list, function(i, item) {
							html += '<tr>';
							html += '<td>' + (i + 1) + '</td>' + '<td>' + item.classname + '</td>' + '<td>' + item.majorname + '</td>' + '<td>' + item.plansize + '</td>' + '<td>' + item.headmastername + '</td>' + '<td style="display:none">' + item.id + '</td>';
							html += '<td class="td-manage">' +
								'<a title="删除" class="layui-btn layui-btn-xs layui-btn-danger" onclick="delClass(' + item.id + ')" lay-event="del" >删除</a>' +
								'<a title="编辑" href="bjgl_xg.html?id=' + item.id + '" class="layui-btn layui-btn-xs" lay-event="edit" >修改</a>' +
								'<a title="查看" href="bjgl_ck.html?id=' + item.id + '" class="layui-btn layui-btn-xs layui-btn-primary">查看</a>' +
								'</td>';
							html += '</tr>';
						})
						$('tbody').html(html);
					},
					error: function() {
						console.log('请求列表错误');
					}
				});
			};
			//执行一个laypage实例
			laypage.render({
				elem: 'text1' //注意，这里的 test1 是 ID，不用加 #号
					,
				count: totalRecord //数据总数，从服务端得到
					,
				curr: pageNum,
				limit: pageSize,
				jump: function(obj, first) {
					//                  //obj包含了当前分页的所有参数，比如：
					pageNum = obj.curr; //得到当前页，以便向服务端请求对应页的数据。
					pageSize = obj.limit; //得到每页显示的条数
					//首次不执行，清除上一页数据
					if(!first) {
						//do something
						$('tbody').empty();
						getNewsData();
					}
				}
			});
		});
	};

	//删除数据
	function delClass(id) {
		$.ajax({
			type: "get",
			async: false,
			url: "api/classes/delete?id=" + id,
			success: function(data) {
				layui.use('layer', function() {
					layer.confirm('确认要删除吗？', function(index) {
						//发异步删除数据
						layer.msg('已删除!', {
							icon: 1,
							time: 1000
						});
						ajaxPLists();
					});
				});
			},
			error: function() {
				console.log('删除失败');
			}
		});
	};

	//查询
	$('#chaXun').click(function() {
		var className = document.getElementById("className").value;
        $.ajax({
            type: 'GET',
            url: "api/classes/class-list",
            async: false, //同步
            data: {
                className: className,
            },
            dataType: 'json',
            success: function (data) {
                if (data.data.total == 0) {
                    layui.use('layer', function () {
                        var layer = layui.layer;
                        layer.msg('该班级不存在！');
                    });
                } else {
                    layui.use('laypage', function () {
                        var laypage = layui.laypage;
                        var totalRecord = 0; //初始化总记录数
                        var pageNum = 1,
                            pageSize = 10; //初始化页数为第一页

                        totalRecord = data.data.total; //数据总条数
                        var chaXunHtml;
                        var len = data.data.list.length;
                        for (var i = 1; i < len + 1; i++) {
                            $('table tr:eq(' + i + ')td:first').text(i);
                        }
                        $.each(data.data.list, function (i, item) {
                            chaXunHtml += '<tr>';
                            chaXunHtml += '<td>' + (i + 1) + '</td>' + '<td>' + item.classname + '</td>' + '<td>' + item.majorname + '</td>' + '<td>' + item.plansize + '</td>' + '<td>' + item.headmastername + '</td>' + '<td style="display:none">' + item.id + '</td>';
                            chaXunHtml += '<td class="td-manage">' +
                                '<a title="删除" class="layui-btn layui-btn-xs layui-btn-danger" onclick="delClass(' + item.id + ')" lay-event="del" >删除</a>' +
                                '<a title="编辑" href="bjgl_xg.html?id=' + item.id + '" class="layui-btn layui-btn-xs" lay-event="edit" >修改</a>' +
                                '<a title="查看" href="bjgl_ck.html?id=' + item.id + '" class="layui-btn layui-btn-xs layui-btn-primary">查看</a>' +
                                '</td>';
                            chaXunHtml += '</tr>';
                        })
                        $("tbody").html(chaXunHtml);

                        //执行一个laypage实例
                        laypage.render({
                            elem: 'text1' //注意，这里的 test1 是 ID，不用加 #号
                            ,
                            count: totalRecord //数据总数，从服务端得到
                            ,
                            curr: pageNum,
                            limit: pageSize,
                            jump: function (obj, first) {
                                //                  //obj包含了当前分页的所有参数，比如：
                                pageNum = obj.curr; //得到当前页，以便向服务端请求对应页的数据。
                                pageSize = obj.limit; //得到每页显示的条数
                                //首次不执行，清除上一页数据
                                if (!first) {
                                    //do something
                                    $('tbody').empty();
                                }
                            }
                        });
                    });
                }
            },
            error: function () {
                layui.use('layer', function () {
                    var layer = layui.layer;
                    layer.msg('查询失败！');
                });
            }
        });
	})