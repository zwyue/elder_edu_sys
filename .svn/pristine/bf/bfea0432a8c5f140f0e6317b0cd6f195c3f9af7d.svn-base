<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<!-- <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">-->
		<title>老年大学系统——用户管理</title>
		<link rel="stylesheet" href="plugins/layui-v2.4.3/layui/css/layui.css"/>
		<link rel="stylesheet" href="css/common_style.css" />
		<link rel="stylesheet" href="css/yhgl_lsgl_jsxz.css" />
		<link rel="stylesheet" href="plugins/form/formSelects-v4.css"/>
	</head>
	<body>
		
		<!--用户管理内容-->
		<div class="layui-body yhglContent">
			<section class="smallNav">
				<span class="layui-breadcrumb yhgl_nav">
				  <a href="javascript:;"><cite>用户管理</cite></a><span lay-separator="">></span>
				  <a href="javascript:;">学生查看</a>
				</span>			
				<span class="fanHui">
					<a href="javascript:history.go(-1);">返回</a>
				</span>								
			</section>
						
			<!--编辑内容-->
			<div class="lsglContent">
				<section class="lsglBt">
					<span class="fl">学生查看</span>					
				</section>
				<div class="layui-form-item">
				    <div class="layui-inline">
				      <label class="layui-form-label">学生姓名：</label>
				      <div class="layui-input-inline">
				        <input type="text"  class="layui-input inputTop layui-disabled" disabled="disabled" id="stunumber"/>
				      </div>
				    </div>
			    	<div class="layui-inline">
				      <label class="layui-form-label">性  &nbsp;&nbsp;&nbsp; 别：</label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input inputTop layui-disabled" disabled="disabled" id="sex"/>
				      </div>
				    </div>	    
				  </div>
				  <div class="layui-form-item">
				    <div class="layui-inline">
				      <label class="layui-form-label">身份证号：</label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input inputTop layui-disabled" disabled="disabled" id="sfzh"/>
				      </div>
				    </div>	
				    <div class="layui-inline">
				      <label class="layui-form-label">民  &nbsp;&nbsp;&nbsp; 族：</label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input inputTop layui-disabled" disabled="disabled" id="nation"/>
				      </div>
				    </div>			    
				  </div>
				  <div class="layui-form-item">
				    <div class="layui-inline">
				      <label class="layui-form-label">年 &nbsp;&nbsp;&nbsp; 龄：</label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input inputTop layui-disabled" disabled="disabled" id="age"/>
				      </div>
				    </div>	
				    <div class="layui-inline">
				      <label class="layui-form-label">联系方式：</label>
				      <div class="layui-input-inline">
				        <input type="tel" lay-verify="required|phone" autocomplete="off" class="layui-input inputTop layui-disabled" disabled="disabled" id="phone"/>
				      </div>
				    </div>		    
				  </div>
				  <div class="layui-form-item">
				    <div class="layui-inline">
				      <label class="layui-form-label">&nbsp;现地址：</label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input inputTop layui-disabled" disabled="disabled" id="address"/>
				      </div>
				    </div>
				    <div class="layui-inline">
				      <label class="layui-form-label">家庭联系方式：</label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input inputTop layui-disabled" disabled="disabled" id="emergency"/>
				      </div>
				    </div>			    
				  </div>
				  <div class="layui-form-item">				    
				    <div class="layui-inline">
				      <label class="layui-form-label">身份证地址：</label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input inputTop layui-disabled" disabled="disabled" id="sfzaddress"/>
				      </div>
				    </div>	
				    <div class="layui-inline">
				      <label class="layui-form-label">车牌号：</label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input inputTop layui-disabled" disabled="disabled" id="carnumber"/>
				      </div>
				    </div>
				  </div>
				  <div class="layui-form-item">				    
				    <div class="layui-inline">
				      <label class="layui-form-label">入学年限：</label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input inputTop layui-disabled" disabled="disabled" id="entertime"/>
				      </div>
				    </div>	
				    <div class="layui-inline">
				      <label class="layui-form-label">毕业时间：</label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input inputTop layui-disabled" disabled="disabled" id="graduatetime"/>
				      </div>
				    </div>
				  </div>
			</div>
			<!--编辑内容end-->
					
			<!--编辑内容-->
			<div class="lsglContent">
				<section class="lsglBt">
					<span class="fl">报名班级</span>					
				</section>
				<!--三级联动-->
				<label class="layui-form-label" style="float: left;font-size: 16px;"> 选择班级：</label>
				<div class="layui-form" style="float: left;width: 90%;">					
				    <select name="city" xm-select="select15" class="classes">				    	
				        <option value="">请选择, 此处是可多选</option>
				    </select>
				</div>
				<div class="clear"></div>				
				<!--三级联动 end-->
			<!--编辑内容end-->
			
		</div>
		<!--用户管理内容 end-->		
	</div>
		<script src="plugins/jQuery/jquery-3.3.1.js"></script>
		<script src="plugins/layui-v2.4.3/layui/layui.js"></script>
		<script type="text/javascript" src="plugins/form/formSelects-v4.js"></script>
		<script>
		layui.use('form', function(){
			//预先加载form表单模块
		    var form = layui.form;										
	    });

        $(function(){
        	//获取浏览地址id
	    	$.getUrlParam = function (name){
	            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
	            var r = window.location.search.substr(1).match(reg);
	            if (r != null) return unescape(r[2]); return null;
	        }
	    	var id=$.getUrlParam('id');
        	//查询该生报名了哪些班级
			var formSelects = layui.formSelects;  //加载模块
			
			//多选查询
	 	$.ajax({
				async: false, //同步
				url: "api/classes/queryclscatetoacquirecls",
				type: "get",
				dataType: "json", 
				success: function(data){
					var  arr =[] ; //定义一个空数组来接收返回的数据					
					listData = data.data;            //拿到一级数据
					for(var i = 0;i<listData.length;i++){
						var obj = {};  //定义一个空对象来接收返回的数据
						//拿到一级的name和value
						obj.name  = listData[i].name;
						obj.value = listData[i].value;	
						obj.children = [];   //定义一级数据的children
						arr.push(obj);       //将一级数据回填到数组里
						
						childData = listData[i].children;  //遍历二级数据						
						//遍历拿到二级数据
						for(var j=0;j<childData.length;j++){
							//拿到二级的name和value
							var objChild = {};
							objChild.name = childData[j].name;
							objChild.value = childData[j].value;
							objChild.children = [];       //定义二级数据的children
							obj.children.push(objChild);  //将二级数据回填到一级数组的children里
							
							lastChildData = childData[j].children; //遍历三级数据
							//遍历拿到三级数据
							for(var num=0;num<lastChildData.length;num++){
								//拿到三级的name和value
								var objLastChild = {};
								objLastChild.name = lastChildData[num].name;
								objLastChild.value = lastChildData[num].value;
								objLastChild.children = [];       //定义三级数据的children
								objChild.children.push(objLastChild);  //将二级数据回填到一级数组的children里
							}							
						}						
					}
					layui.formSelects.data('select15', 'local', {
						arr,
						linkage: true   //可多选
					})
				},
				error:function(){
					layui.use('layer', function(){
					  var layer = layui.layer;					  
					  layer.msg('请求班级分类错误');
					});   
				}				
			});
			
        	//查询到id，并把表格页面的值带到修改页面
            $.ajax({ 
                type: 'GET',
                url: "api/student/all-detail?id="+id,
                async: false,
                dataType:'json',
                success: function (data){
                	var returnData = data.data.baseInfo;
                	var classData = data.data.value;
                	
                	//将后台返回的数据回填到表单里
                    $("#stunumber").val(returnData.stunumber);
                    $("#sex").val(returnData.sex);
                    $("#sfzh").val(returnData.sfzh);
                    $("#nation").val(returnData.nation);
                    $("#age").val(returnData.age);
                    $("#phone").val(returnData.phone);
                    $("#address").val(returnData.address);
                    $("#emergency").val(returnData.emergency);
                    $("#sfzaddress").val(returnData.sfzaddress);
                    $("#carnumber").val(returnData.carnumber);
                    $("#entertime").val(returnData.entertime);
                    $("#graduatetime").val(returnData.graduatetime);
//                 	console.log(classData);
                    formSelects.value('select15',classData);   //将选中的班级回显
                    formSelects.disabled();                    //禁用下拉框
                },
                error: function(){
                    layui.use('layer', function(){
                        var layer = layui.layer;
                        layer.msg('未查到数据');
                    });
                }
            });  
            
   });
	</script>

	</body>
</html>
