			//左侧导航
		    layui.use('element', function(){
		          var element = layui.element;
		     });


            // 大事记表格
            $(function () {

                //分页
                var pageNum = 0;//初始化页数为第一页
                var pageSize = 3;
                layui.use('laypage', function () {
                    var laypage = layui.laypage;
                    var totalRecord = 0;//初始化总记录数
                    //每页显示条数7条
                    getNewsData();

                    function getNewsData() {
                        $.ajax({
                            type: "get",
                            async: false,
                            url: "http://192.168.0.166:8080/memorabilia/list",
                            data: {
                                page: pageNum,
                                size: pageSize
                            },
                            success: function (data) {
                                totalRecord = data.data.total;//数据总条数
                                // console.log(data.data.total);
                                var html;
                                var len = data.data.list.length;
                                for (var i = 1; i < len + 1; i++) {
                                    $('table tr:eq(' + i + ')td:first').text(i);
                                }
                                console.log(data.data.list);
                                $.each(data.data.list, function (i, item) {
                                    html += '<tr>';
                                    html += '<td>' + (i + 1) + '</td>';
                                    html += '<td>' + item.title + '</td>' + '<td>' + item.crttime + '</td>';
                                    html += '<td><a onclick="sc_delect(' + item.id + ')" href="JavaScript:;" class="bg bgActive del">删除</a>' +
                                        '<a href="http://192.168.0.162:8083/dagl_dsjxg.html?id=' + item.id + '" class="bg change">修改</a>' +
                                        '<a href="http://192.168.0.166:8080/memorabilia/export?id=' + item.id + '" class="bg look">导出</a></td>';
                                    html += '</tr>';
                                })
                                $("#listDsj").append(html);
                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                                alert(XMLHttpRequest.status);
                                alert(XMLHttpRequest.readyState);
                                alert(textStatus);
                            }
                        });
                    }

                    //执行一个laypage实例
                    laypage.render({
                        elem: 'demo5' //注意，这里的 test1 是 ID，不用加 #号
                        , count: totalRecord //数据总数，从服务端得到
                        , curr: pageNum
                        , limit: pageSize
                        , jump: function (obj, first) {
                            //obj包含了当前分页的所有参数，比如：
                            pageNum = obj.curr;//得到当前页，以便向服务端请求对应页的数据。
                            pageSize = obj.limit;//得到每页显示的条数

                            //首次不执行
                            if (!first) {
                                //do something
                                $('#listDsj').empty();
                                getNewsData();
                            }
                        }
                    });
                })

//              $.ajax({
//                  type: 'GET',
//                  url: "http://192.168.0.166:8080/memorabilia/list",
//                  async: false,
//                  data:{
//                      // page:0,size:3
//					},
//                  dataType:'json',
//                  xhrFields: {withCredentials: true},
//                  success: function (data) {
//                      // console.log(data.data.list);
//                      var html;
//                      var len = data.data.list.length;
//                      for(var i = 1;i<len+1;i++){
//                          $('table tr:eq('+i+')td:first').text(i);
//                      }
//                      console.log(data.data.list);
//                      $.each(data.data.list,function(i,item){
//                          html+='<tr>';
//                          html+='<td>'+(i+1)+'</td>';
//                          html+='<td>'+item.title+'</td>'+'<td>'+item.crttime+'</td>';
//                          html+='<td><a onclick="sc_delect('+item.id+')" href="JavaScript:;" class="bg bgActive del">删除</a>' +
//								'<a href="http://192.168.0.162:8083/dagl_dsjxg.html?id='+item.id+'" class="bg change">修改</a>' +
//								'<a href="http://192.168.0.166:8080/memorabilia/export?id='+item.id+'" class="bg look">导出</a></td>';
//                          html+='</tr>';
//                      })
//                      $("#listDsj").append(html);
//                  },
//                  error: function () {
//                      layui.use('layer', function(){
//                          var layer = layui.layer;
//                          layer.msg('获取数据失败！');
//                      });
//                  }
//              });
            });

            //删除
            function sc_delect(id) {
                $.ajax({
                    type: 'GET',
                    url: "http://192.168.0.166:8080/memorabilia/delete",
                    async: false,
                    data: {
                        id: id
                    },
                    dataType: 'json',
                    xhrFields: {withCredentials: true},
                    success: function (data) {
                        console.log(id);
                        if (confirm('确定要删除吗')) {
                            $(this).parents('tr').remove();
                        }

                    },
                    error: function () {
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.msg('删除失败！');
                        });
                    }
                });
            }

            //查询
            function getTitle() {
                var title=document.getElementById("filterName").value;
                $.ajax({
                    type: 'GET',
                    url: "http://192.168.0.166:8080/memorabilia/getTitle",
                    async: false,
                    data: {
                        title: title
                    },
                    dataType: 'json',
                    xhrFields: {withCredentials: true},
                    success: function (data) {

                        var chaXun;
                        var len = data.data.list.length;
                        for(var i = 1;i<len+1;i++){
                            $('table tr:eq('+i+')td:first').text(i);
                        }
                        $.each(data.data.list,function(i,item){
                            chaXun+='<tr>';
                            chaXun+='<td>'+(i+1)+'</td>';
                            chaXun+='<td>'+item.title+'</td>'+'<td>'+item.crttime+'</td>';
                            chaXun+='<td><a onclick="sc_delect('+item.id+')" href="JavaScript:;" class="bg bgActive del">删除</a>' +
                                '<a href="dagl_dsjxg.html" class="bg change">修改</a>' +
                                '<a href="http://192.168.0.166:8080/memorabilia/export?id='+item.id+'" class="bg look">导出</a></td>';
                            chaXun+='</tr>';

                        })
                        $("#listDsj").replaceWith(chaXun);

                    },
                    error: function () {
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.msg('查询失败！');
                        });
                    }
                });
            }


