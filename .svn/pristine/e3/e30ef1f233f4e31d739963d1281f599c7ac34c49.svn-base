<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>老年大学系统——排课管理</title>
    <link rel="stylesheet" href="plugins/layui-v2.4.3/layui/css/layui.css"/>
    <link rel="stylesheet" href="css/common_style.css" />
    <link rel="stylesheet" href="font/iconfont.css"/>
    <link rel="stylesheet" href="css/pkgl.css"/>
	<link rel="stylesheet" href="font/iconfont-zdpk.css"/>
</head>
<body id="bzrgl">
  <!--排课管理-自动排课--->
  <div class="layui-body pkglContent">
		<span class="layui-breadcrumb pkgl_nav">
		  <a href="pkgl_ksdgl.html"><cite>排课管理</cite></a><span lay-separator="">></span>
          <a href="pkgl_ksdgl.html"><cite>自动排课</cite></a>
		</span>
    <!--内容部分-->
	   <div class="content_zdpk">
		  <div class="contain_text">
               	<div class="contain-left">
                    <span class="bmbj_bj">自动排课</span>
                </div>
                <!--<div class="contain-right">
                    <button type="button" class="ydbtn" id="ksdxz" name="btn"><i class="iconfont icon-daochu"></i>添加</button>
                </div>-->
                <div class="clear"></div>
           </div>
		   <div class="bjwtyjy_content">
			  <form class="layui-form" action="">
				  <div class="layui-form-item layui-form" lay-filter="weekTime">
					  <div class="layui-inline">
						  <label class="layui-form-label">排课时间：</label>
						  <div class="layui-input-inline">
							  <select name="" lay-verify="required" id="week">
							  		<option value="0">请选择</option>
							  </select>
						  </div>
					  </div>
					  <div class="layui-inline">
						  <div class="layui-input-inline">
							  <select name="" lay-verify="required" id="time">
								  <option value="">请选择时间段</option>
							  </select>
						  </div>
					  </div>
				  </div>
				  <div class="layui-form-item layui-form" lay-filter="classroomType">
					  <div class="layui-inline">
						  <label class="layui-form-label">排课教室：</label>
						  <div class="layui-input-inline">
							  <select name="classroomType" lay-verify="required" id="classroomType">
								  <option value="">请选择类别</option>
							  </select>
						  </div>
					  </div>
					  <div class="layui-inline">
						  <div class="layui-input-inline">
							  <select name="" lay-verify="required" id="classroom">
								  <option value="">请选择教室</option>
							  </select>
						  </div>
					  </div>
				  </div>
				  <div class="layui-form-item">
					  <div class="layui-inline layui-form" lay-filter="classCategory">
						  <label class="layui-form-label">排课班级：</label>
						  <div class="layui-input-inline">
							  <select lay-verify="required" id="classCategory">
								  <option value="">请选择类别</option>
							  </select>
						  </div>
					  </div>
					  <div class="layui-inline layui-form" lay-filter="classMajor">
						  <div class="layui-input-inline">
							  <select  lay-verify="required" id="classMajor">
								  <option value="">请选择专业</option>
							  </select>
						  </div>
					  </div>
					  <div class="layui-inline">
						  <div class="layui-input-inline layui-form" lay-filter="classes">
							  <select lay-verify="required" id="classes">
								  <option value="">请选择班级</option>
							  </select>
						  </div>
					  </div>
				  </div>
				  			  
				  <!--<div class="layui-form-item btn_anniu">
					  <div class="layui-input-block">
						  <button class="layui-btn" lay-submit lay-filter="formDemo">自动排课</button>
					  </div>
				  </div>-->
			  </form>
		  </div>
		  <a href="javascript:;" class="bcBtn" id="saveClass">保存</a>
	   </div>
	   
	   <!--<div class="right_content">
		   <div class="right_icon"><i class="iconfont icon-xiaoxi"></i> </div>
		   <div class="right_text">
			   <p>该教室已被占用，请更换教室！！！</p>
		   </div>
	   </div>-->
    <!--内容部分end-->
  </div>
  <!--排课管理-自动排课end-->

  <script src="plugins/jQuery/jquery-3.3.1.js"></script>
  <script src="plugins/layui-v2.4.3/layui/layui.js"></script>
  <script>
	layui.use('form',function(){
		var form = layui.form;
  		//定义星期数据
	  	var weekArr = [
	  		{value:'1',name:'周一'},
	  		{value:'2',name:'周二'},
	  		{value:'3',name:'周三'},
	  		{value:'4',name:'周四'},
	  		{value:'5',name:'周五'},
	  		{value:'6',name:'周六'},
	  		{value:'7',name:'周天'},
	  	];
	  	$.each(weekArr, function(){
	        $('<option value="'+this.value+'">'+this.name+'</option>').appendTo('#week');                   	
	    });
	    //更新 lay-filter="weekTime"所在容器内的全部 select 状态
            form.render('select','weekTime');	
		//找到渲染后的dd
	    var dlChild = $('#week').siblings("div.layui-form-select").find('dl').children();
	    //遍历dd,给每个dd添加onclick事件
	    for (var i = 1; i < dlChild.length; i++){
	        $(dlChild[i]).attr('onclick', 'queryTime(' + i + ')');
	    }
	});
    
    //根据选择的星期查询那一天的时间段
    	$.ajax({
    		type:'post',
    		async:false,
    		url:'api/schedule-class/pre/list', 		
    		dataType:'json',
    		success:function(data){
    			layui.use('form',function(){
	  				var form = layui.form;
	  				var i = 0;
	  				$.each(data.data.list, function (i, result) {
	                    $("#time").append('<option value="' + result.id + '">' + result.time + '</option>');
	                });
		            //更新 lay-filter="weekTime"所在容器内的全部 select 状态
		            form.render('select','weekTime');		            
	  			})
    		},
    		error:function(){
    			layui.use('layer', function(){
	                var layer = layui.layer;
	                layer.msg('查询时间段失败');
	            });
    		}
    	})

  	
  	//查询教室类别并回显
  	$.ajax({
  		type:'get',
  		async:false,
  		url:'api/classroom/typelist',
  		dataType:'json',
  		success:function(data){
  			layui.use('form',function(){
  				var form = layui.form;
  				var i = 0;
  				$.each(data.data.list, function (i, result) {
                    $("#classroomType").append('<option onclick="queryClass(' + result.id + ')" value="' + result.id + '">' + result.catename + '</option>');
                });
	            //更新 lay-filter="classroomType"所在容器内的全部 select 状态
	            form.render('select','classroomType');
	            //找到渲染后的dd
                var dlChild = $('#classroomType').siblings("div.layui-form-select").find('dl').children();
                //遍历dd,给每个dd添加onclick事件
                for (var i = 1; i < dlChild.length; i++){
                    $(dlChild[i]).attr('onclick', 'queryClass(' + i + ')');
                }
  			})         	          
  		},
  		error:function(){
  			layui.use('layer', function(){
                var layer = layui.layer;
                layer.msg('查询班级类别失败');
            });
  		}
  	})
  	//根据教室类别查班级
  	function queryClass(id){
  		$.ajax({
	  		type:'post',
	  		async:false,
	  		url:'api/classroom/list',
	  		dataType:'json',
	  		data:{
	  			cateid:id   //带到后台的教室类别id
	  		},
	  		success:function(data){
	  			layui.use('form',function(){
	  				var form = layui.form;
	  				var i = 0;
	  				$.each(data.data.list, function (i, result) {
	                    $("#classroom").append('<option value="' + result.id + '">' + result.classroom + '</option>');
	                });
		            //更新 lay-filter="classroomType"所在容器内的全部 select 状态
		            form.render('select','classroomType');
	  			})
	  		},
	  		error:function(){
	  			layui.use('layer', function(){
	                var layer = layui.layer;
	                layer.msg('查询班级失败');
	            });
	  		}
	  		
	  	})
  	};
  	//保存自动排课信息
  	$('#saveClass').click(function(){
  		var weekId   = $('#week option:selected').val();   //weekId
//		var weekText = $('#week option:selected').text();  
  		var timeId   = $('#time option:selected').val();   //时间段id
//		var timeText   = $('#time option:selected').text();
//		var classroomTypeId = $('#classroomType option:selected').val();  //教室类别id
//		var classroomTypeText = $('#classroomType option:selected').text();
//		var classroomId =  $('#classroom option:selected').val();  
		var classroomText =  $('#classroom option:selected').text();       //教室名称
//		var classCategoryId = $('#classCategory option:selected').val();  //班级类别id
//		var classCategoryText = $('#classCategory option:selected').text();
//		var classMajorId = $('#classMajor option:selected').val();    //班级专业id
//		var classMajorText = $('#classMajor option:selected').text();
  		var classesId  = $('#classes option:selected').val();    //班级id
  		var classesText  = $('#classes option:selected').text();
  		//点击保存
  		$.ajax({
  			type:'post',
  			async:false,
  			dataType:'json',
  			data:{
  				week:weekId,   					 //weekid
  				courseid:timeId,                 //时间段id
  				classroom:classroomText,         //教室名称
  				classid:classesId,       		 //班级id
  				classname:classesText    		 //班级名称
  			},
  			url:'api/schedule-class/schedule-course',
  			success:function(data){
  				//判断教室是否被占用
  				if(data.code == 1){
	  				layui.use('layer', function(){
		                var layer = layui.layer;
		                layer.msg('保存排课信息成功');
		            });
		            setTimeout(function(){
		            	window.location.reload();  //刷新本页面
		            },800);		            
  				}else{
					layui.use('layer', function(){
		                var layer = layui.layer;
		                layer.msg(data.msg);
		            });
  				}
  			},
  			error:function(){
  				layui.use('layer', function(){
	                var layer = layui.layer;
	                layer.msg('保存排课信息失败');
	            });
  			}
  		})
  		
  		
  	})
  </script>
  <script type="text/javascript" src="js/yhgl_lsgl_select.js"></script>

</body>
</html>