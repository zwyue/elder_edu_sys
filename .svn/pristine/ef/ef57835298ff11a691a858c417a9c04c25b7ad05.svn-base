package com.zrtjoa.controller.archive;

import com.zrtjoa.entity.Memorabilia;
import com.zrtjoa.service.MemorabiliaService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.List;

/**
 * 档案管理
 *
 * @author zwy
 * @date 2018/11/28 14:08
 */
@Controller
@RequestMapping("memorabilia")
public class MemorabiliaController {

    private static final Logger logger = LoggerFactory.getLogger(MemorabiliaController.class);

    @Autowired
    private MemorabiliaService memorabiliaService ;

    /**
     * 新增档案
     *
     * @author zwy
     * @date 2018/11/28 14:08
     */
    @RequestMapping(value = "save" ,method = RequestMethod.POST)
    @ResponseBody
    public String saveMemorabilia(Memorabilia memorabilia){
        logger.info("========保存档案=======");
        memorabilia.setUserid(1);
        memorabilia.setUsername("username");
        memorabiliaService.saveMemorabilia(memorabilia);
        //前台Ajax需要返回数据为json，否则不会进入success函数
        return "{ \"msg\":\"success\"}" ;
    }

    @RequestMapping(value = "toSave" ,method = RequestMethod.GET)
    public String toSavePage(String content){
        return "archives/memorabilia/memorabilia_add";
    }

    /**
     * 档案删除
     *
     * @author zwy
     * @date 2018/11/28 14:09
     */
    @RequestMapping(value = "delete" ,method = RequestMethod.GET)
    public String deleteMemorabilia(Integer idList[]){

        logger.info("======删除{}条档案======",idList.length);
        memorabiliaService.deleteMemorabilia(idList);

        return "redirect:/memorabilia/list" ;
    }

    /**
     * 档案更新
     *
     * @author zwy
     * @date 2018/11/28 14:09
     */
    @RequestMapping(value = "update" ,method = RequestMethod.POST)
    @ResponseBody
    public String updateMemorabilia(Memorabilia memorabilia){
        logger.info("=========档案更新=========");
        memorabiliaService.updateMemorabilia(memorabilia);
        return "{ \"msg\":\"success\"}" ;
    }

    /**
     * 档案查询
     *
     * @author zwy
     * @date 2018/11/28 14:09
     */
    @RequestMapping(value = "queryMemorabiliaById" ,method = RequestMethod.GET)
    public String queryMemorabilia(Integer id,Model model){
        logger.info("========查询id为{}的档案========",id);
        Memorabilia memorabilia = memorabiliaService.queryMemorabiliaById(id);
        model.addAttribute("memorabilia",memorabilia);
        return "archives/memorabilia/memorabilia_update";
    }

    /**
     * 档案列表
     *
     * @author zwy
     * @date 2018/11/28 14:10
     */
    @RequestMapping(value = "list" ,method = RequestMethod.GET)
    public String toDetail(Model model,Memorabilia memorabilia){
        logger.info("========查询档案列表========");
        List<Memorabilia> list = memorabiliaService.queryAllMemorabilia(memorabilia);
        model.addAttribute("list",list);
        return "archives/memorabilia/memorabilia_list";
    }
}
